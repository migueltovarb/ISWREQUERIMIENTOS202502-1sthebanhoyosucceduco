{% extends 'base.html' %}

{% block title %}Factura - Cafetería{% endblock %}

{% block extra_css %}
<style>
    .factura-container {
        background: white;
        border: 2px solid #333;
        border-radius: 10px;
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .factura-header {
        border-bottom: 3px solid var(--primary-color);
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .factura-table {
        width: 100%;
        margin: 1.5rem 0;
    }
    
    .factura-table th {
        background-color: var(--primary-color);
        color: white;
        padding: 0.75rem;
        text-align: left;
    }
    
    .factura-table td {
        padding: 0.75rem;
        border-bottom: 1px solid #ddd;
    }
    
    .total-row {
        background-color: #f8f9fa;
        font-weight: bold;
        font-size: 1.2rem;
    }
    
    @media print {
        .no-print {
            display: none !important;
        }
        
        .factura-container {
            border: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="factura-container shadow-lg">
    <div class="factura-header">
        <div class="row">
            <div class="col-md-6">
                <h2><i class="bi bi-cup-hot-fill"></i> CAFETERÍA</h2>
                <p class="mb-0">Sistema de Pedidos</p>
            </div>
            <div class="col-md-6 text-md-end">
                <h4>Factura</h4>
                <p class="mb-0"><strong>Factura N°:</strong> FCT-{{ comprobante.id_pedido|stringformat:"06d" }}</p>
                <p class="mb-0"><strong>Fecha:</strong> {{ comprobante.fecha|date:"d/m/Y" }}</p>
                <p class="mb-0"><strong>Hora:</strong> {{ comprobante.fecha|date:"g:i A" }}</p>
            </div>
        </div>
    </div>
    
    <div class="mb-4">
        <h5><i class="bi bi-person-circle"></i> Cliente: {{ comprobante.cliente }}</h5>
    </div>
    
    <div class="mb-3">
        <strong><i class="bi bi-receipt"></i> Método de pago:</strong> 
        {% if metodo_pago == 'efectivo' %}
            Efectivo
        {% elif metodo_pago == 'tarjeta' %}
            Tarjeta
        {% elif metodo_pago == 'digital' %}
            Pago digital (Nequi/Daviplata)
        {% else %}
            {{ metodo_pago|title }}
        {% endif %}
    </div>
    
    <table class="factura-table">
        <thead>
            <tr>
                <th>Producto</th>
                <th class="text-center">Cantidad</th>
                <th class="text-end">Precio</th>
                <th class="text-end">Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in comprobante.items %}
                <tr>
                    <td>{{ item.producto }}</td>
                    <td class="text-center">{{ item.cantidad }}</td>
                    <td class="text-end">${{ item.subtotal|floatformat:0 }}</td>
                    <td class="text-end">${{ item.subtotal|floatformat:0 }}</td>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="3" class="text-end">Total a Pagar</td>
                <td class="text-end">${{ comprobante.total|floatformat:0 }}</td>
            </tr>
        </tfoot>
    </table>
    
    <div class="alert alert-success mb-4">
        <div class="d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-3" style="font-size: 2rem;"></i>
            <div>
                <h5 class="mb-1">¡Pedido confirmado!</h5>
                <p class="mb-0">Tu pedido ha sido registrado exitosamente.</p>
                <p class="mb-0"><strong>Estado:</strong> <span class="badge bg-success">{{ comprobante.estado }}</span></p>
            </div>
        </div>
    </div>
    
    <div class="text-center mb-4">
        <p class="mb-0">Número de pedido: <strong>{{ pedido.IDPedido|stringformat:"06d" }}</strong></p>
        <p class="text-muted small">Guarda este número para seguimiento</p>
    </div>
    
    <div class="text-center border-top pt-3 mt-3">
        <p class="mb-0"><small>Gracias por tu preferencia</small></p>
        <p class="mb-0"><small>¡Esperamos verte pronto!</small></p>
    </div>
</div>

<div class="text-center mt-4 no-print">
    <div class="d-flex gap-2 justify-content-center flex-wrap">
        <button onclick="window.print()" class="btn btn-primary btn-lg">
            <i class="bi bi-printer"></i> Imprimir Factura
        </button>
        <a href="{% url 'progreso_pedido' pedido.IDPedido %}" class="btn btn-accent btn-lg">
            <i class="bi bi-eye"></i> Ver Progreso del Pedido
        </a>
        <a href="{% url 'inicio_pedido' %}" class="btn btn-outline-secondary btn-lg">
            <i class="bi bi-house"></i> Ir al Inicio
        </a>
    </div>
</div>
{% endblock %}